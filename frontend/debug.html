<!DOCTYPE html>
<html>
  <head>
    <title>Debug Snacks Store</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>
  <body class="bg-gray-50 p-8">
    <h1 class="text-2xl font-bold mb-4">Debug Snacks Store</h1>

    <!-- Loading indicator -->
    <div id="loading" class="text-center py-8">
      <p class="text-blue-600">Loading products...</p>
    </div>

    <!-- Error message -->
    <div id="error" class="hidden text-center py-8">
      <p class="text-red-600">
        Failed to load products. Please try again later.
      </p>
    </div>

    <!-- Products grid container -->
    <div
      id="products-grid"
      class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 hidden"
    >
      <!-- Product cards will be inserted here dynamically -->
    </div>

    <!-- No products message -->
    <div id="no-products" class="hidden text-center py-8">
      <p class="text-gray-500">No products found.</p>
    </div>

    <script>
      // API Configuration
      const API_BASE_URL = "http://127.0.0.1:8001/api";

      // DOM Elements
      let loadingElement;
      let errorElement;
      let productsGrid;
      let noProductsElement;

      function showElement(element) {
        element.classList.remove("hidden");
      }

      function hideElement(element) {
        element.classList.add("hidden");
      }

      function showLoading() {
        showElement(loadingElement);
        hideElement(errorElement);
        hideElement(productsGrid);
        hideElement(noProductsElement);
      }

      function showError() {
        hideElement(loadingElement);
        showElement(errorElement);
        hideElement(productsGrid);
        hideElement(noProductsElement);
      }

      function showProducts() {
        hideElement(loadingElement);
        hideElement(errorElement);
        showElement(productsGrid);
        hideElement(noProductsElement);
      }

      async function fetchProducts() {
        try {
          console.log("Fetching products from:", `${API_BASE_URL}/products/`);
          const response = await fetch(`${API_BASE_URL}/products/`);
          console.log("Response status:", response.status);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          console.log("Raw API response:", data);

          // Extract products from paginated response
          const products = data.results || data;
          console.log("Extracted products:", products);

          return products;
        } catch (error) {
          console.error("Error fetching products:", error);
          throw error;
        }
      }

      function createProductCard(product) {
        const productCard = document.createElement("div");
        productCard.className =
          "bg-white rounded-xl overflow-hidden shadow-sm border";

        productCard.innerHTML = `
                <div class="p-4">
                    <h3 class="font-semibold text-gray-900">${product.name}</h3>
                    <p class="text-sm text-gray-500 mt-1">${
                      product.description || "No description"
                    }</p>
                    <p class="text-lg font-bold text-green-600 mt-2">â‚¹${parseFloat(
                      product.price
                    ).toFixed(2)}</p>
                </div>
            `;

        return productCard;
      }

      function renderProducts(products) {
        console.log("Rendering", products.length, "products");
        productsGrid.innerHTML = "";

        if (products.length === 0) {
          showElement(noProductsElement);
          return;
        }

        products.forEach((product, index) => {
          console.log(`Rendering product ${index + 1}:`, product);
          const productCard = createProductCard(product);
          productsGrid.appendChild(productCard);
        });

        showProducts();
      }

      async function init() {
        try {
          console.log("Initializing debug app...");

          // Initialize DOM elements
          loadingElement = document.getElementById("loading");
          errorElement = document.getElementById("error");
          productsGrid = document.getElementById("products-grid");
          noProductsElement = document.getElementById("no-products");

          console.log("DOM elements:", {
            loading: !!loadingElement,
            error: !!errorElement,
            productsGrid: !!productsGrid,
            noProducts: !!noProductsElement,
          });

          showLoading();

          const products = await fetchProducts();
          renderProducts(products);
        } catch (error) {
          console.error("Init error:", error);
          showError();
        }
      }

      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
